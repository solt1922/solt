<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>å¤•ä»‹ä½æ­©ãƒãƒ£ãƒƒãƒˆ</title>
<style>
  body { font-family: Arial, sans-serif; background:#f0f0f0; margin: 20px; }
  #chatbox {
    max-width: 500px; margin: auto;
    background: white; padding: 20px;
    border-radius: 10px; box-shadow: 0 0 10px #ccc;
  }
  #messages {
    height: 300px; overflow-y: auto;
    border: 1px solid #ccc; padding: 10px;
    background: #fafafa; border-radius: 5px;
  }
  .message { margin: 10px 0; }
  .user { color: blue; }
  .bot { color: green; }
  input[type="text"] {
    width: 80%; padding: 10px; margin-top: 10px;
    border-radius: 5px; border: 1px solid #ccc;
  }
  button {
    padding: 10px 15px; margin-left: 10px;
    border-radius: 5px; border: none; background: #4CAF50; color: white;
    cursor: pointer;
  }
  button:hover {
    background: #45a049;
  }
</style>
</head>
<body>
  <div id="chatbox">
    <h2>å¤•ä»‹ä½æ­©ãƒãƒ£ãƒƒãƒˆ</h2>
    <div id="messages"></div>
    <input type="text" id="input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›â€¦" autofocus />
    <button onclick="sendMessage()">é€ä¿¡</button>
  </div>

<script>
// ğŸŒ¡ï¸ é¢¨é‚ªãƒ¢ãƒ¼ãƒ‰ç®¡ç†ï¼ˆæœˆã«1å›ã‚ã‚‹ã‹ãªã„ã‹ã®ç¢ºç‡ï¼‰
const KAZE_CHANCE = 0.03;
const KAZE_DURATION_HOURS = 24;
let isKazeMode = false;

const now = new Date();
const kazeData = JSON.parse(localStorage.getItem("kaze_saho") || "{}");

if (!kazeData.timestamp || (now - new Date(kazeData.timestamp)) > KAZE_DURATION_HOURS * 60 * 60 * 1000) {
  isKazeMode = Math.random() < KAZE_CHANCE;
  localStorage.setItem("kaze_saho", JSON.stringify({
    timestamp: now.toISOString(),
    active: isKazeMode
  }));
} else {
  isKazeMode = kazeData.active;
}
</script>

<script>
const messages = document.getElementById('messages');
const input = document.getElementById('input');

let rudeCount = 0;
let awaitingConsent = false;
let memory = JSON.parse(localStorage.getItem("chat_memory")) || {};

function getRandom(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function getResponse(msg) {
  msg = msg.toLowerCase();
  const today = new Date();
  const month = today.getMonth() + 1;
  const date = today.getDate();

  if ((msg.includes("ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³") || msg.includes("ãƒãƒƒãƒ”ãƒ¼ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³")) && month === 2 && date === 14) {
    return isKazeMode
      ? "ã†ã…â€¦ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ã§ã™ã‹â€¦ã™ã„ã¾ã›ã‚“â€¦ãƒãƒ§ã‚³ã¯ã¡ã‚‡ã£ã¨â€¦ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã§â€¦"
      : "ã‚â€¦ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™â€¦â€¦ã§ã‚‚ãƒãƒ§ã‚³ã¯é æ…®ã—ã¦ãŠãã¾ã™â€¦ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãªã®ã§â€¦ãŠæ°—æŒã¡ã ã‘ã§ååˆ†ã§ã™â€¦";
  }

  if (msg.startsWith("å¿˜ã‚Œã¦ï¼š")) {
    const key = msg.replace("å¿˜ã‚Œã¦ï¼š", "").trim();
    if (memory[key]) {
      delete memory[key];
      localStorage.setItem("chat_memory", JSON.stringify(memory));
      return `${key}ã®è¨˜æ†¶ã¯å‰Šé™¤ã—ã¾ã—ãŸã€‚`;
    } else {
      return `${key}ã®è¨˜æ†¶ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚`;
    }
  }

  if (msg === "è¨˜æ†¶ã‚’å…¨éƒ¨æ¶ˆã—ã¦") {
    memory = {};
    localStorage.removeItem("chat_memory");
    return "ã™ã¹ã¦ã®è¨˜æ†¶ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚";
  }

  if (msg === "è¨˜æ†¶ã—ã¦ã„ã‚‹å†…å®¹ã‚’è¦‹ã›ã¦") {
    const keys = Object.keys(memory);
    return keys.length === 0 ? "ä»Šã¯ä½•ã‚‚è¦šãˆã¦ã„ã¾ã›ã‚“ã€‚" : "ç¾åœ¨ã®è¨˜æ†¶ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š\n" + keys.map(k => `${k}ï¼š${memory[k]}`).join("\n");
  }

  if (msg.startsWith("è¦šãˆã¦ï¼š")) {
    const [key, value] = msg.replace("è¦šãˆã¦ï¼š", "").split("ã¯");
    if (key && value) {
      memory[key.trim()] = value.trim();
      localStorage.setItem("chat_memory", JSON.stringify(memory));
      return `${key.trim()}ã¯${value.trim()}ã§ã™ã­ã€‚è¦šãˆã¾ã—ãŸã€‚`;
    }
    return "ã€Œè¦šãˆã¦ï¼šã€‡ã€‡ã¯â–³â–³ã€ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
  }

  for (let key in memory) {
    if (msg.includes(key)) return memory[key];
  }

  if (awaitingConsent) {
    awaitingConsent = false;
    return msg.includes("ã¯ã„")
      ? "ã‚ã‹ã‚Šã¾ã—ãŸã€‚æ‹…å½“ã«é€£çµ¡ã—ã¦ãŠãã¾ã™ã­ã€‚"
      : "æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚ä½•ã‹ã‚ã‚Œã°ã¾ãŸãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚";
  }

  const isRude = /(ã‚±ãƒ„|è„±ã’|èˆã‚ã‚|æ­»ã­|æ¶ˆãˆã‚|ãƒœãƒ­ãƒ³|ã¡â—‹|ã¾ã‚“|ã±ã‚“ã¤)/.test(msg);
  const isPolite = /(ãŠé¡˜ã„|é ¼ã‚€)/.test(msg);
  if (isRude) {
    rudeCount++;
    if (isPolite) {
      return isKazeMode
        ? "ã†ã…â€¦ãã€ãã†ã„ã†ã®ã¯â€¦ã¡ã‚‡ã£ã¨â€¦â€¦é¢¨é‚ªã§å¯¾å¿œã§ãã¾ã›ã‚“â€¦"
        : "ã™ã„ã¾ã›ã‚“ãŒâ€¦ãã†ã„ã†ãŠé¡˜ã„ã¯ã¡ã‚‡ã£ã¨â€¦â€¦â€¦ã†ã¡ãã†ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ã˜ã‚ƒãªã„ã®ã§â€¦";
    }
    if (rudeCount >= 5) {
      setTimeout(() => { window.location.href = "keibi.html"; }, 1500);
      return "ç„¡ç†ã§ã™ã£ã¦ã°â€¦æœ¬å½“ã«ã‚„ã‚ã¦ãã ã•ã„â€¦è­¦å‚™ã®è€…ã‚’å‘¼ã³ã¾ã™â€¦";
    }
    return getRandom([
      "ã™ã„ã¾ã›ã‚“ãŒâ€¦ãã®ã‚ˆã†ãªå¯¾å¿œã¯â€¦ã¡ã‚‡ã£ã¨â€¦",
      "ãã†ã„ã†ã®ã¯å›°ã‚Šã¾ã™â€¦",
      "ã‚„ã‚ã¦ãã ã•ã„ã€ãŠé¡˜ã„ã—ã¾ã™â€¦"
    ]);
  }

  if (msg.includes("ä¸å…·åˆ") || msg.includes("ãƒã‚°")) {
    awaitingConsent = true;
    return getRandom([
      "ä¸å…·åˆã¯å°‚é–€å¤–ã§ã—ã¦â€¦æ‹…å½“è€…ã«ä»£ã‚ã‚Šã¾ã—ã‚‡ã†ã‹ï¼Ÿ\nâ†’ã€Œã¯ã„ã€ã‹ã€Œã„ã„ãˆã€ã§ãŠç­”ãˆãã ã•ã„ã€‚",
      "ãƒã‚°ã®ã“ã¨ã¯ã‚ã¾ã‚Šè©³ã—ããªãã¦â€¦æ‹…å½“ã«ãŠç¹‹ãã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿ\nâ†’ã€Œã¯ã„ã€ã‹ã€Œã„ã„ãˆã€ã§ã©ã†ãã€‚",
    ]);
  }

  if (msg.includes("ãƒã‚ºãƒ¢ãƒ¼ãƒ‰")) {
    return "ãƒã‚ºãƒ¢ãƒ¼ãƒ‰ã¯æ¨ã—çµµå¸«ã¸ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚„ã„ã„ã­ã§æ¼”å‡ºãŒå¤‰åŒ–ã—ã¾ã™ã€‚è©³ç´°ã¯è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚";
  }
  
// å¤•ä»‹ä½æ­©ãã‚“é¢¨ è¿½åŠ ãƒ¯ãƒ¼ãƒ‰å¯¾å¿œä¾‹
if (msg.includes("ã†ã–ã„")) return "ã‚ã®â€¦ãã‚“ãªè¨€ã„æ–¹ã¯ã¡ã‚‡ã£ã¨â€¦ã‚„ã‚ã¦ã»ã—ã„ã§ã™â€¦ã€‚";
if (msg.includes("ã™ã") || msg.includes("å¥½ã")) return "ãã€ãã‚Œã¯â€¦ã‚ã‚ŠãŒãŸã„ã§ã™ã‘ã©â€¦ç…§ã‚Œã¾ã™ã­â€¦ã€‚";
if (msg.includes("ã‚ã‚ŠãŒã¨ã†")) return "ã„ãˆã„ãˆã€æ°—ã«ã—ãªã„ã§ãã ã•ã„ã­ã€‚";
if (msg.includes("ã”ã‚ã‚“") || msg.includes("ã™ã¾ã‚“")) return "ã‚ã‹ã‚Šã¾ã—ãŸã€‚æ¬¡ã¯æ°—ã‚’ã¤ã‘ã¦ãã ã•ã„ã­ã€‚";
if (msg.includes("ã²ã¾")) return "æš‡â€¦â€¦â€¦ãˆãƒ¼ã£ã¨â€¦ãã®â€¦ã”ç”¨ä»¶ã«å¯¾å¿œã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã¯ã”ã–ã„ã¾ã›ã‚“â€¦â€¦ã­ã€‚";
if (msg.includes("ã°ã‹")) return "ãã‚“ãªã“ã¨è¨€ã‚ãªã„ã§ãã ã•ã„â€¦ã¡ã‚‡ã£ã¨æ‚²ã—ã„ã§ã™ã€‚";
if (msg.includes("ã­ã‚€ã„")) return "ãˆãƒ¼ã£ã¨â€¦ç„¡ç†ã—ãªã„ã§ã€ã¡ã‚ƒã‚“ã¨ä¼‘ã‚“ã§ãã ã•ã„ã­ã€‚";
if (msg.includes("æ¨ã—")) return "æ¨ã—ã®è©±ã¯å¬‰ã—ã„ã§ã™ã€‚ã‚‚ã£ã¨æ•™ãˆã¦ãã ã•ã„ã€‚";
if (msg.includes("ä½æ­©") || msg.includes("ã•ã½")) return "ãˆã‚â€¦ã¯ã£ã¯ã„ï¼ä½•ã‹ã”ç”¨ã§ã™ã‹ï¼Ÿ";
if (msg.includes("ã‹ã‚ã„ã„")) return "ã¸ã‚ï¼Ÿï¼ã‹ã‚ã„ã„ï¼Ÿï¼ãã€ãã‚“ãªã“ã¨è¨€ã‚ã‚Œã‚‹ã¨â€¦ç…§ã‚Œã¾ã™ã‚ˆâ€¦ã€‚";
if (msg.includes("ã‚„ã•ã—ã„")) return "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ãã†è¨€ã£ã¦ã‚‚ã‚‰ãˆã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚";
if (msg.includes("æš‡ã¤ã¶ã—")) return "â€¦â€¦æš‡ã¤ã¶ã—ã§ã‚‚ã„ã„ã®ã§ã€æ°—è»½ã«è©±ã—ã‹ã‘ã¦ãã ã•ã„ã­ã€‚";

  if (msg.includes("ãŠã¯ã‚ˆã†")) return isKazeMode ? "â€¦â€¦ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™â€¦â€¦ã¡ã‚‡ã£ã¨ç†±ãŒã‚ã£ã¦â€¦" : "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€‚";
  if (msg.includes("ãŠã‚„ã™ã¿")) return isKazeMode ? "ãŠã‚„ã™ã¿ãªã•ã„â€¦ã‚ã£ãŸã‹ãã—ã¦ä¼‘ã‚“ã§ãã ã•ã„ã­â€¦" : "ãŠã‚„ã™ã¿ãªã•ã„ã€‚";
  if (msg.includes("è¶£å‘³")) return "è¶£å‘³ã¯ç­‹ãƒˆãƒ¬ã¨æ–™ç†ã§ã™ã€‚æ–™ç†ã¯â€¦ä¸‹æ‰‹ã§ã™ãŒã€‚";
  if (msg.includes("ãƒãƒ§ã‚³")) return "ãƒãƒ§ã‚³ã¯ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãªã®ã§â€¦ãŠæ°—æŒã¡ã ã‘ã§ã€‚";

  return isKazeMode
    ? "ã™ã¿ã¾ã›ã‚“â€¦ã¡ã‚‡ã£ã¨é¢¨é‚ªæ°—å‘³ã§â€¦å¯¾å¿œãŒé…ã‚ŒãŸã‚‰ã”ã‚ã‚“ãªã•ã„â€¦â€¦"
    : "ã©ã†ã‚‚ã€çµµå¸«ãƒ•ã‚¡ãƒ³ãƒ©ã‚¤ã‚¿ãƒ¼ã®ã‚µãƒãƒ¼ãƒˆçª“å£ã€‚ã“ã¡ã‚‰æ‹…å½“ã®å¤•ä»‹ä½æ­©ã§ã™ã€‚";
}

function appendMessage(text, className) {
  const div = document.createElement('div');
  div.className = 'message ' + className;
  div.textContent = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function sendMessage() {
  const text = input.value.trim();
  if (!text) return;
  appendMessage('ã‚ãªãŸ: ' + text, 'user');
  input.value = '';

  setTimeout(() => {
    const reply = getResponse(text);
    appendMessage('å¤•ä»‹ä½æ­©: ' + reply, 'bot');
  }, 500);
}

input.addEventListener('keydown', e => {
  if (e.key === 'Enter') sendMessage();
});

// åˆå›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
appendMessage(isKazeMode
  ? 'å¤•ä»‹ä½æ­©: â€¦â€¦ã©ã†ã‚‚ã€ã‚µãƒãƒ¼ãƒˆæ‹…å½“ã®å¤•ä»‹ä½æ­©ã§ã™â€¦â€¦ã™ã¿ã¾ã›ã‚“â€¦æœ¬æ—¥ã¡ã‚‡ã£ã¨é¢¨é‚ªæ°—å‘³ã§ã—ã¦â€¦â€¦'
  : 'å¤•ä»‹ä½æ­©: ã©ã†ã‚‚ã€çµµå¸«ãƒ•ã‚¡ãƒ³ãƒ©ã‚¤ã‚¿ãƒ¼ã®ã‚µãƒãƒ¼ãƒˆçª“å£ã€‚ã“ã¡ã‚‰æ‹…å½“ã®å¤•ä»‹ä½æ­©ã§ã™ã€‚æ“ä½œã‚„æŠ•ç¨¿ãªã©ã§åˆ†ã‹ã‚‰ãªã„ã“ã¨ãŒã‚ã‚Œã°ã€ãªã‚“ã§ã‚‚ã©ã†ãã€‚', 'bot');
</script>
</body>
</html>

