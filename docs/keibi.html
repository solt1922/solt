<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>è­¦å‚™å“¡ã®èª¬æ•™éƒ¨å±‹</title>
<style>
  body { font-family: Arial, sans-serif; background:#222; color: white; margin: 20px; }
  #chatbox {
    max-width: 500px; margin: auto;
    background: #333; padding: 20px;
    border-radius: 10px; box-shadow: 0 0 10px #000;
  }
  #messages {
    height: 300px; overflow-y: auto;
    border: 1px solid #444; padding: 10px;
    background: #111; border-radius: 5px;
  }
  .message { margin: 10px 0; }
  .user { color: #00ccff; }
  .keibi { color: #ff5050; }
  input[type="text"] {
    width: 80%; padding: 10px; margin-top: 10px;
    border-radius: 5px; border: 1px solid #555; background: #222; color: white;
  }
  button {
    padding: 10px 15px; margin: 10px 5px 0 0;
    border-radius: 5px; border: none; background: #ff5050; color: white;
    cursor: pointer;
  }
  button:hover {
    background: #e64545;
  }
  #reflection-form {
    margin-top: 15px;
  }
  textarea {
    width: 100%; border-radius: 5px;
    background: #222; color: white;
    padding: 10px; border: 1px solid #555;
  }
</style>
</head>
<body>
  <div id="chatbox">
    <h2>è­¦å‚™å“¡ã®èª¬æ•™éƒ¨å±‹</h2>
    <div id="messages"></div>
    <input type="text" id="input" placeholder="åçœã®è¨€è‘‰ã‚’è¿°ã¹ãªã•ã„â€¦" autofocus />
    <button onclick="sendMessage()">é€ä¿¡</button>
    <button onclick="showReflectionForm()">ğŸ“ åçœæ–‡ã‚’æ›¸ã</button>

    <div id="reflection-form" style="display: none;">
      <textarea id="reflection-text" rows="4" placeholder="ã“ã“ã«åçœæ–‡ã‚’æ›¸ããªã•ã„â€¦"></textarea>
      <button onclick="submitReflection()">æå‡ºã™ã‚‹</button>
    </div>
  </div>

<script>
const messages = document.getElementById('messages');
const input = document.getElementById('input');

function appendMessage(text, className) {
  const div = document.createElement('div');
  div.className = 'message ' + className;
  div.textContent = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function getRandom(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function getKeibiResponse(msg) {
  msg = msg.toLowerCase();

  const vulgarWords = ["ã¡â—‹ã“", "ã¾â—‹ã“", "ãƒœãƒ­ãƒ³", "ã‚±ãƒ„", "è„±ã’", "èˆã‚ã‚", "ã‚»ãƒƒã‚¯ã‚¹", "ä¹³", "å‹ƒèµ·"];
  const offensiveWords = ["æ®ºã™", "æ­»ã­", "ã¶ã£æ®ºã™", "å¤‰æ…‹", "ãã", "ãµã–ã‘", "ã†ã‚“ã“", "ã–ã‘ã‚“ãª"];

  const isVulgar = vulgarWords.some(word => msg.includes(word));
  const isOffensive = offensiveWords.some(word => msg.includes(word));

  if (isVulgar) {
    return getRandom([
      "â€¦â€¦ä¸‹å“ã«ã‚‚ç¨‹ãŒã‚ã‚‹ãã€‚",
      "ãã†ã„ã†è¨€è‘‰ã¯å£ã«ã™ã‚‹ãªã£ã¦è¨€ã£ã¦ã‚‹ã ã‚ã†ãŒï¼",
      "ãŠå‰ã®èªå½™åŠ›ãŒå¿ƒé…ã«ãªã‚‹ãã€ãƒã‚¸ã§ã€‚",
      "ãã‚“ãªç™ºè¨€ã‚’ã“ã“ã§åããªã€æ¥ã‚’çŸ¥ã‚Œã€‚"
    ]);
  }

  if (isOffensive) {
    return getRandom([
      "è²´æ§˜ã€èª°ã«å‘ã‹ã£ã¦å£ã‚’åˆ©ã„ã¦ã„ã‚‹ï¼",
      "æš´è¨€ã¯å³ã‚¢ã‚¦ãƒˆã€‚èª¬æ•™è¿½åŠ ãªã€‚",
      "ãŠå‰ã€ã¾ãŸã‚„ã£ãŸãªï¼Ÿæ ¹æ€§å©ãç›´ã™ãã€‚",
      "ãã®æš´è¨€ã€éŒ²éŸ³æ¸ˆã¿ã ã€‚è¦šæ‚Ÿã—ã‚ã€‚"
    ]);
  }

  if (msg.includes("ã”ã‚ã‚“ãªã•ã„") || msg.includes("åçœ")) {
    return getRandom([
      "åçœã—ã¦ã‚‹ãªã‚‰æ…‹åº¦ã§ç¤ºã—ã¦ã‚‚ã‚‰ãŠã†ã‹ã€‚",
      "åçœæ–‡ã‚’3æšæ›¸ã„ã¦æå‡ºã ã€‚",
      "ãã®ç¨‹åº¦ã®è¬ç½ªã§ã¯æ¸ˆã¾ã•ã‚Œãªã„ãã€‚",
      "å£°ãŒå°ã•ã„ï¼ã‚‚ã£ã¨å¤§ããåçœã®æ„ã‚’è¡¨ã›ï¼"
    ]);
  }

  if (msg.includes("è¨±ã—ã¦") || msg.includes("ã‚†ã‚‹ã—ã¦")) {
    return getRandom([
      "ç°¡å˜ã«è¨±ã•ã‚Œã‚‹ã¨æ€ã†ãªã‚ˆï¼Ÿ",
      "â€¦â€¦ã¾ã‚ã€ä»Šå›ã¯è¦‹é€ƒã—ã¦ã‚„ã‚ã†ã€‚",
      "è¨±ã—ã‚’ä¹ã†å‰ã«ã‚„ã‚‹ã¹ãã“ã¨ãŒã‚ã‚‹ã¯ãšã ã€‚",
      "æ¡ä»¶ä»˜ãã§ãªã‚‰è¨±ã™ã€‚æ¬¡ã¯ãªã„ã¨æ€ãˆã€‚"
    ]);
  }

  if (msg.includes("ãªã‚“ã§") || msg.includes("ã©ã†ã—ã¦")) {
    return getRandom([
      "å·±ã®è¡Œå‹•ã‚’ã‚ˆãæ€ã„å‡ºã—ã¦ã¿ã‚ã€‚",
      "ç†ç”±ã¯è²´æ§˜ã®è¨€å‹•ã™ã¹ã¦ã«ã‚ã‚‹ã€‚",
      "è¦å‰‡ã«å¾“ã‚ã¬è€…ã«ç†ç”±ãªã©ä¸è¦ã ã€‚",
      "è¨€ã‚ã›ã‚‹ãªâ€¦æ¥ã‚’çŸ¥ã‚Œã€‚"
    ]);
  }

  if (msg.includes("é»™ã‚Œ") || msg.includes("ã†ã‚‹ã•ã„")) {
    return getRandom([
      "åçœã™ã‚‹æ°—ãŒãªã„ã‚ˆã†ã ãªï¼Ÿè¿½åŠ ã§30åˆ†ã ã€‚",
      "æ•¬æ„ã®æ¬ ç‰‡ã‚‚ãªã„ãªâ€¦â€¦ã‚„ã‚Šç›´ã—ã ã€‚",
      "å£ç­”ãˆã‹ï¼Ÿã‚ˆã—ã€èª¬æ•™2å€ãƒ¢ãƒ¼ãƒ‰çªå…¥ã ã€‚",
      "è²´æ§˜ã€ä»Šãªã‚“ã¨è¨€ã£ãŸï¼Ÿ"
    ]);
  }

  return getRandom([
    "é»™ã£ã¦èã‘ã€‚ã“ã“ã¯èª¬æ•™éƒ¨å±‹ã ã€‚",
    "ä½™è¨ˆãªã“ã¨ã¯è¨€ã†ãªã€‚åçœã ã‘ã—ã¦ã„ã‚ã€‚",
    "ã“ã£ã¡ã¯æš‡ã˜ã‚ƒãªã„ã€‚æ—©ãæ”¹å¿ƒã—ã‚ã€‚",
    "ãŠã—ã‚ƒã¹ã‚Šã®æ™‚é–“ã˜ã‚ƒãªã„ãã€‚çœŸé¢ç›®ã«ã‚„ã‚Œã€‚",
    "ã¾ãšã¯è½ã¡ç€ã‘ã€‚æ·±å‘¼å¸ã‹ã‚‰ã ã€‚"
  ]);
}

function sendMessage() {
  const text = input.value.trim();
  if (!text) return;
  appendMessage('ã‚ãªãŸ: ' + text, 'user');
  input.value = '';

  setTimeout(() => {
    const reply = getKeibiResponse(text);
    appendMessage('è­¦å‚™å“¡: ' + reply, 'keibi');
  }, 500);
}

function showReflectionForm() {
  document.getElementById('reflection-form').style.display = 'block';
}

function submitReflection() {
  const text = document.getElementById('reflection-text').value.trim();
  if (!text) {
    alert("åçœæ–‡ãŒç©ºã§ã™ï¼");
    return;
  }

  appendMessage("ã‚ãªãŸï¼ˆåçœæ–‡ï¼‰: " + text, 'user');
  document.getElementById('reflection-text').value = '';
  document.getElementById('reflection-form').style.display = 'none';

  const vulgarWords = ["ã¡â—‹ã“", "ã¾â—‹ã“", "ãƒœãƒ­ãƒ³", "ã‚±ãƒ„", "è„±ã’", "èˆã‚ã‚", "ã‚»ãƒƒã‚¯ã‚¹", "ä¹³", "å‹ƒèµ·"];
  const offensiveWords = ["æ®ºã™", "æ­»ã­", "ã¶ã£æ®ºã™", "å¤‰æ…‹", "ãã", "ãµã–ã‘", "ã†ã‚“ã“", "ã–ã‘ã‚“ãª"];

  const isVulgar = vulgarWords.some(word => text.includes(word));
  const isOffensive = offensiveWords.some(word => text.includes(word));

  setTimeout(() => {
    if (isVulgar) {
      appendMessage("è­¦å‚™å“¡: " + getRandom([
        "ãŠã„ã€ãã®åçœæ–‡â€¦â€¦ä¸‹ãƒã‚¿æ›¸ãå ´æ‰€ã˜ã‚ƒã­ã‡ãï¼",
        "å†…å®¹ãŒä¸é©åˆ‡ã ã€‚ãµã–ã‘ã¦ã‚‹ã®ã‹ï¼Ÿ",
        "åçœæ–‡ã‚’ä¸‹å“ãªè¨€è‘‰ã§æ±šã™ãªã€‚",
        "ã“ã“ã¯ä¸‹ãƒã‚¿æå‡ºç®±ã˜ã‚ƒãªã„ã€‚ã‚„ã‚Šç›´ã›ã€‚"
      ]), 'keibi');
    } else if (isOffensive) {
      appendMessage("è­¦å‚™å“¡: " + getRandom([
        "æš´è¨€åçœæ–‡ï¼ï¼Ÿãµã–ã‘ã‚‹ãªï¼",
        "è¬ç½ªã™ã‚‹æ°—ãŒã‚ã‚‹ã¨ã¯æ€ãˆã‚“ã€‚èª¬æ•™å€ãªã€‚",
        "ãã®æ–‡ç« ã€æŒ‘ç™ºã ã¨åˆ¤æ–­ã™ã‚‹ã€‚å‡¦ç†è¿½åŠ ã ã€‚",
        "æš´è¨€ã‚’åçœæ–‡ã«æ··ãœã‚‹ãªã€‚å³å´ä¸‹ã€‚"
      ]), 'keibi');
    } else {
      appendMessage("è­¦å‚™å“¡: " + getRandom([
        "ãµã‚€ã€ã‚ˆãæ›¸ã‘ã¦ã„ã‚‹ã€‚ä»Šå›ã¯è¦‹é€ƒã—ã¦ã‚„ã‚ã†ã€‚",
        "ãã®åçœæ–‡ã§ã¯ã¾ã è¶³ã‚Šã‚“ã€‚ã‚‚ã£ã¨çœŸå‰£ã«æ›¸ã‘ï¼",
        "â€¦â€¦ã†ã‚€ã€‚ãã®æ°—æŒã¡ãŒã‚ã‚‹ãªã‚‰ã‚ˆã—ã€‚",
        "ã ã„ã¶åçœã®è‰²ã¯è¦‹ãˆãŸãªã€‚æ¬¡ã¯æ°—ã‚’ã¤ã‘ã‚ã€‚"
      ]), 'keibi');
    }
  }, 700);
}

input.addEventListener('keydown', e => {
  if (e.key === 'Enter') sendMessage();
});

// åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
appendMessage('è­¦å‚™å“¡: ã•ã¦ã¨ã€ã‚ˆã†çŠ¯ç½ªè€…ã•ã‚“ã‚ˆã€‚ãŠå‰ã«ã¯ã“ã“ã§æ…‹åº¦ã‚’æ”¹ã‚ã¦ã‚‚ã‚‰ã†ã€‚', 'keibi');
</script>
</body>
</html>
