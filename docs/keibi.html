<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>è­¦å‚™å“¡ã®èª¬æ•™éƒ¨å±‹</title>
<style>
  body { font-family: Arial, sans-serif; background:#222; color: white; margin: 20px; }
  #chatbox {
    max-width: 500px; margin: auto;
    background: #333; padding: 20px;
    border-radius: 10px; box-shadow: 0 0 10px #000;
  }
  #messages {
    height: 300px; overflow-y: auto;
    border: 1px solid #444; padding: 10px;
    background: #111; border-radius: 5px;
  }
  .message { margin: 10px 0; }
  .user { color: #00ccff; }
  .keibi { color: #ff5050; }
  input[type="text"] {
    width: 80%; padding: 10px; margin-top: 10px;
    border-radius: 5px; border: 1px solid #555; background: #222; color: white;
  }
  button {
    padding: 10px 15px; margin: 10px 5px 0 0;
    border-radius: 5px; border: none; background: #ff5050; color: white;
    cursor: pointer;
  }
  button:hover {
    background: #e64545;
  }
  #reflection-form {
    margin-top: 15px;
  }
  textarea {
    width: 100%; border-radius: 5px;
    background: #222; color: white;
    padding: 10px; border: 1px solid #555;
  }
</style>
</head>
<body>
  <div id="chatbox">
    <h2>è­¦å‚™å“¡ã®èª¬æ•™éƒ¨å±‹</h2>
    <div id="messages"></div>
    <input type="text" id="input" placeholder="åçœã®è¨€è‘‰ã‚’è¿°ã¹ãªã•ã„â€¦" autofocus />
    <button onclick="sendMessage()">é€ä¿¡</button>
    <button onclick="showReflectionForm()">ğŸ—’ åçœæ–‡ã‚’æ›¸ã</button>

    <div id="reflection-form" style="display: none;">
      <textarea id="reflection-text" rows="4" placeholder="ã“ã“ã«åçœæ–‡ã‚’æ›¸ããªã•ã„â€¦"></textarea>
      <button onclick="submitReflection()">æå‡ºã™ã‚‹</button>
    </div>
  </div>

<script>
const messages = document.getElementById('messages');
const input = document.getElementById('input');
let visitCount = Number(localStorage.getItem('visitCount') || 0) + 1;
localStorage.setItem('visitCount', visitCount);

function appendMessage(text, className) {
  const div = document.createElement('div');
  div.className = 'message ' + className;
  div.textContent = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function getRandom(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function submitReflection() {
  const text = document.getElementById('reflection-text').value.trim();
  if (!text) {
    alert("åçœæ–‡ãŒç©ºã§ã™ï¼");
    return;
  }
  appendMessage("ã‚ãªãŸï¼ˆåçœæ–‡ï¼‰: " + text, 'user');
  document.getElementById('reflection-text').value = '';
  document.getElementById('reflection-form').style.display = 'none';

  const vulgarWords = ["ã¡â—‹ã“", "ã¾â—‹ã“", "ãƒœãƒ­ãƒ³", "ã‚±ãƒ„", "è„±ã’", "èˆã‚ã‚", "ã‚»ãƒƒã‚¯ã‚¹", "ä¹³", "å‹ƒèµ·", "ã‚¢ãƒŠãƒ«"];
  const offensiveWords = ["æ®ºã™", "æ­»ã­", "ã¶ã£æ®ºã™", "å¤‰æ…‹", "ãã", "ãµã–ã‘", "ã†ã‚“ã“", "ã–ã‘ã‚“ãª"];
  const isVulgar = vulgarWords.some(word => text.includes(word));
  const isOffensive = offensiveWords.some(word => text.includes(word));

  setTimeout(() => {
    if (isVulgar) {
      appendMessage("è­¦å‚™å“¡: " + getRandom([
        "ãŠã„ã€ãã®åçœæ–‡â€¦â€¦ä¸‹ãƒã‚¿æ›¸ãå ´æ‰€ã˜ã‚ƒã­ã‡ãï¼",
        "å†…å®¹ãŒä¸é©åˆ‡ã ã€‚ãµã–ã‘ã¦ã‚‹ã®ã‹ï¼Ÿ",
        "åçœæ–‡ã‚’ä¸‹å“ãªè¨€è‘‰ã§æ±šã™ãªã€‚",
        "ã“ã“ã¯ä¸‹ãƒã‚¿æå‡ºç®±ã˜ã‚ƒãªã„ã€‚ã‚„ã‚Šç›´ã›ã€‚"
      ]), 'keibi');
    } else if (isOffensive) {
      appendMessage("è­¦å‚™å“¡: " + getRandom([
        "æš´è¨€åçœæ–‡ï¼ï¼Ÿãµã–ã‘ã‚‹ãªï¼",
        "è¬ç½ªã™ã‚‹æ°—ãŒã‚ã‚‹ã¨ã¯æ€ãˆã‚“ã€‚èª¬æ•™å€ãªã€‚",
        "ãã®æ–‡ç« ã€æŒ‘ç™ºã ã¨åˆ¤æ–­ã™ã‚‹ã€‚å‡¦ç†è¿½åŠ ã ã€‚",
        "æš´è¨€ã‚’åçœæ–‡ã«æ··ãœã‚‹ãªã€‚å³å´ä¸‹ã€‚"
      ]), 'keibi');
    } else {
      let replyPool = [];
      if (visitCount <= 2) {
        replyPool = [
          "ãµã‚€ã€ã‚ˆãæ›¸ã‘ã¦ã„ã‚‹ã€‚ä»Šå›ã¯è¦‹é€ƒã—ã¦ã‚„ã‚ã†ã€‚",
          "ãã®åçœæ–‡ã§ã¯ã¾ã è¶³ã‚Šã‚“ã€‚ã‚‚ã£ã¨çœŸå‰£ã«æ›¸ã‘ï¼",
          "â€¦â€¦ã†ã‚€ã€‚ãã®æ°—æŒã¡ãŒã‚ã‚‹ãªã‚‰ã‚ˆã—ã€‚",
          "ã ã„ã¶åçœã®è‰²ã¯è¦‹ãˆãŸãªã€‚æ¬¡ã¯æ°—ã‚’ã¤ã‘ã‚ã€‚"
        ];
      } else if (visitCount <= 4) {
        replyPool = [
          "ä½•åº¦ç›®ã®åçœæ–‡ã ã‚ˆâ€¦â€¦æ›¸ãæ…£ã‚Œã¦ã‚‹æ„Ÿã‚ã‚‹ãªã€‚",
          "å­—é¢ã ã‘ã˜ã‚ƒãƒ€ãƒ¡ã ã€‚æœ¬æ°—ã§æ›¸ã„ã¦ã‚‹ã‹ï¼Ÿ",
          "ã¾ãŸã“ã®ç¨‹åº¦ã‹â€¦â€¦ä»•æ–¹ãªã„ã€èª­ã‚“ã§ã¯ã‚„ã‚‹ã€‚",
          "ãŠå‰ã®åçœæ–‡ã€æ¯å›åŒã˜ã‚ˆã†ã«è¦‹ãˆã‚‹ãã€‚"
        ];
      } else {
        replyPool = [
          "ãªã‚ã¦ã‚“ã®ã‹ï¼Ÿå´ä¸‹ã ã€‚ã‚„ã‚Šç›´ã›ã€‚",
          "ä½•å›åŒã˜åçœæ–‡æ›¸ã„ã¦ã‚“ã ã‚ˆã€‚å¿ƒãŒã“ã‚‚ã£ã¦ã­ãˆã€‚",
          "èª­ã¿ãŸããªã„ã€‚æ°—æŒã¡ãŒä¼ã‚ã£ã¦ã“ãªã„ã‚“ã ã‚ˆã€‚",
          "ã¯ã‚â€¦â€¦ä½•å›ç›®ï¼Ÿå½¢ã ã‘ã®è¬ç½ªã¯ã„ã‚‰ã‚“ã€‚"
        ];
      }
      appendMessage("è­¦å‚™å“¡: " + getRandom(replyPool), 'keibi');
    }
  }, 700);
}
</script>
</body>
</html>
