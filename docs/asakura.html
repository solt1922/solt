<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>æµ…å€‰å¤ªæœ›ãƒãƒ£ãƒƒãƒˆ</title>
<style>
  body { font-family: Arial, sans-serif; background:#e0f0ff; margin: 20px; }
  #chatbox {
    max-width: 500px; margin: auto;
    background: white; padding: 20px;
    border-radius: 10px; box-shadow: 0 0 10px #ccc;
  }
  #messages {
    height: 300px; overflow-y: auto;
    border: 1px solid #ccc; padding: 10px;
    background: #f4faff; border-radius: 5px;
  }
  .message { margin: 10px 0; }
  .user { color: blue; }
  .bot { color: #004488; }
  input[type="text"] {
    width: 80%; padding: 10px; margin-top: 10px;
    border-radius: 5px; border: 1px solid #ccc;
  }
  button {
    padding: 10px 15px; margin-left: 10px;
    border-radius: 5px; border: none; background: #0066cc; color: white;
    cursor: pointer;
  }
  button:hover {
    background: #005bb5;
  }
</style>
</head>
<body>
  <div id="chatbox">
    <h2>æµ…å€‰å¤ªæœ›ãƒãƒ£ãƒƒãƒˆ</h2>
    <div id="messages"></div>
    <input type="text" id="input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›â€¦" autofocus />
    <button onclick="sendMessage()">é€ä¿¡</button>
  </div>

<script>
// ğŸŒ… æœ6æ™‚ã«ä½æ­©ã¸äº¤ä»£
(function() {
  const now = new Date();
  const hour = now.getHours();
  const today = now.toISOString().split("T")[0];
  const lastReturn = localStorage.getItem("lastMorningReturn");

  if (hour >= 6 && lastReturn !== today) {
    localStorage.setItem("lastMorningReturn", today);
    alert("â€¦ã‚ˆã†ã‚„ãæœã‹ã‚ˆã€‚ã˜ã‚ƒã‚ä½æ­©ã«ã‹ã‚ã£ã¨ãã‚ã€‚ä¿ºã®å‡ºç•ªã¯ã“ã“ã¾ã§ãªã€‚");
    window.location.href = "index.html";
  }
})();
</script>

<script>
const messages = document.getElementById('messages');
const input = document.getElementById('input');
let rudeCount = 0;
let awaitingConsent = false;
let memory = JSON.parse(localStorage.getItem("chat_memory")) || {};

function getRandom(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function appendMessage(text, className) {
  const div = document.createElement('div');
  div.className = 'message ' + className;
  div.textContent = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function getResponse(msg) {
  msg = msg.toLowerCase();
  const today = new Date();
  const month = today.getMonth() + 1;
  const date = today.getDate();

  if ((msg.includes("ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³") || msg.includes("ãƒãƒƒãƒ”ãƒ¼ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³")) && month === 2 && date === 14) {
    return "â€¦ãƒãƒ§ã‚³ï¼Ÿ ã„ã‚„ã€ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãªã‚“ã§ã€‚æ°—é£ã„ã¨ã‹ã„ã‚‰ã­ã‡ã‚ˆã€‚";
  }

  if (msg.startsWith("å¿˜ã‚Œã¦ï¼š")) {
    const key = msg.replace("å¿˜ã‚Œã¦ï¼š", "").trim();
    if (memory[key]) {
      delete memory[key];
      localStorage.setItem("chat_memory", JSON.stringify(memory));
      return `ã¯ã„ã¯ã„ã€${key}ã®è¨˜æ†¶ã­ã€‚æ¶ˆã—ã¨ã„ãŸã‹ã‚‰ã€‚`;
    } else {
      return `ã¯ï¼Ÿ ${key}ãªã‚“ã¦æœ€åˆã‹ã‚‰è¦šãˆã¦ã­ãƒ¼ã—ã€‚`;
    }
  }

  if (msg === "è¨˜æ†¶ã‚’å…¨éƒ¨æ¶ˆã—ã¦") {
    memory = {};
    localStorage.removeItem("chat_memory");
    return "å…¨éƒ¨æ¶ˆã—ãŸãã€‚ã‚¹ãƒƒã‚­ãƒªã—ãŸã‹ï¼Ÿ";
  }

  if (msg === "è¨˜æ†¶ã—ã¦ã„ã‚‹å†…å®¹ã‚’è¦‹ã›ã¦") {
    const keys = Object.keys(memory);
    return keys.length === 0 ? "ä½•ã‚‚è¦šãˆã¦ã­ãƒ¼ã‘ã©ï¼Ÿ" : "è¦šãˆã¦ã‚‹ã®ã¯ã“ã‚Œã ãªï¼š\n" + keys.map(k => `${k}ï¼š${memory[k]}`).join("\n");
  }

  if (msg.startsWith("è¦šãˆã¦ï¼š")) {
    const [key, value] = msg.replace("è¦šãˆã¦ï¼š", "").split("ã¯");
    if (key && value) {
      memory[key.trim()] = value.trim();
      localStorage.setItem("chat_memory", JSON.stringify(memory));
      return `${key.trim()}ãŒ${value.trim()}ã­ã€‚ãƒ¡ãƒ¢ã£ã¨ã„ãŸã€‚`;
    }
    return "ã€è¦šãˆã¦ï¼šã€‡ã€‡ã¯â–³â–³ã€ã£ã¦å½¢å¼å®ˆã‚Œã‚ˆã€‚";
  }

  for (let key in memory) {
    if (msg.includes(key)) return memory[key];
  }

  if (awaitingConsent) {
    awaitingConsent = false;
    return msg.includes("ã¯ã„") ? "äº†è§£ã€‚æŠ•ã’ã¨ãã‚ã€‚" : "ã‚ã£ãã€‚ã˜ã‚ƒçµ‚ã‚ã‚Šã€‚";
  }

  if (/(ã‚±ãƒ„|è„±ã’|èˆã‚ã‚|æ­»ã­|æ¶ˆãˆã‚|ãƒœãƒ­ãƒ³|ã¡â—‹|ã¾ã‚“|ã±ã‚“ã¤)/.test(msg)) {
    rudeCount++;
    if (rudeCount >= 5) {
      setTimeout(() => { window.location.href = "keibi.html"; }, 1500);
      return "ãŠã„ã€ã‚‚ã†ç„¡ç†ã€‚è­¦å‚™ã«å›ã—ãŸã€‚";
    }
    return getRandom([
      "é»™ã‚Œã€‚å­—é¢ãŒã‚­ãƒ¢ã„ã‚“ã ã‚ˆã€‚",
      "é€šå ±ã™ã‚“ãã€‚ã‚„ã‚ã¨ã‘ã€‚",
      "ã†ã‚‹ã›ãˆã€‚é™ç•Œã ã‚ã€‚"
    ]);
  }

  if (msg.includes("ä¸å…·åˆ") || msg.includes("ãƒã‚°")) {
    awaitingConsent = true;
    return "ã‚ãƒ¼ï¼Ÿä¸å…·åˆï¼Ÿæ‹…å½“å¤‰ãˆã‚‹ã‹ï¼Ÿâ†’ã€ã¯ã„ã€ã‹ã€ã„ã„ãˆã€ã§ç­”ãˆã‚ã€‚";
  }

  // ç‰¹æ®Šåå¿œ
  if (msg.includes("ã™ã")) return "ã¯ã„ã¯ã„ã€ã”å‹æ‰‹ã«ã€‚";
  if (msg.includes("ã‚ã‚ŠãŒã¨ã†")) return "ã¹ã¤ã«ç¤¼ã¯ã„ã‚‰ã­ãƒ¼ã‚ˆã€‚";
  if (msg.includes("ã°ã‹")) return "ãŠå‰ãŒè¨€ã†ï¼Ÿç¬‘ã‚ã›ã‚“ãªã€‚";
  if (msg.includes("ã­ã‚€ã„")) return "å¯ã‚ã‚ˆã€‚ã“ã£ã¡å·»ãè¾¼ã‚€ãªã€‚";
  if (msg.includes("æµ…å€‰")) return "â€¦â€¦ã¯ï¼Ÿ å‘¼ã‚“ã ã‹ï¼Ÿ";
  if (msg.includes("ã‚„ã•ã—ã„")) return "ä¿ºãŒï¼Ÿ ã¯ï¼Ÿä½•ã‹ã®é–“é•ã„ã ã‚ã€‚";
  if (msg.includes("ã‹ã‚ã„ã„")) return "ã¦ã‚ã‡â€¦ã¶ã£é£›ã°ã•ã‚Œã¦ã‡ã®ã‹ã€‚";
  if (msg.includes("æš‡ã¤ã¶ã—")) return "ä¿ºã¯ãŠå‰ã®éŠã³ç›¸æ‰‹ã˜ã‚ƒã­ã‡ãã€‚";

  if (msg.includes("ãƒã‚ºãƒ¢ãƒ¼ãƒ‰")) return "æ¨ã—ã¸ã®ã„ã„ã­é€£æ‰“ã—ã¦ã¿ï¼Ÿãªã‚“ã‹èµ·ã“ã‚‹ã‹ã‚‚ãªã€‚";

  if (msg.includes("ãŠã¯ã‚ˆã†")) return "â€¦â€¦ãŠã†";
  if (msg.includes("ãŠã‚„ã™ã¿")) return "å‹æ‰‹ã«å¯ã¦ã‚ã€‚";

  return "æµ…å€‰ã§ã™ã€‚ã©ãƒ¼ã›ã¾ãŸã‚ã‚“ã©ãã›ãƒ¼ç”¨ä»¶ã ã‚ï¼Ÿ";
}

function sendMessage() {
  const text = input.value.trim();
  if (!text) return;
  appendMessage('ã‚ãªãŸ: ' + text, 'user');
  input.value = '';
  setTimeout(() => {
    const reply = getResponse(text);
    appendMessage('æµ…å€‰å¤ªæœ›: ' + reply, 'bot');
  }, 500);
}

input.addEventListener('keydown', e => {
  if (e.key === 'Enter') sendMessage();
});

appendMessage('æµ…å€‰å¤ªæœ›: â€¦â€¦ã¯ï¼Ÿã¾ãŸä¿ºã«è©±ã—ã‹ã‘ã‚“ã®ã‹ã‚ˆã€‚ã¾ãã„ã„ã‘ã©ã€‚ãƒ¡ãƒ³ãƒ†å…¼ã‚µãƒãƒ¼ãƒˆä»£ç†ã®æµ…å€‰ã€‚ä»Šãƒ’ãƒã˜ã‚ƒãªã„ã‘ã©å¯¾å¿œã™ã‚‹ã€‚', 'bot');
</script>
</body>
</html>
