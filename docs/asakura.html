<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>æµ…å€‰å¤ªæœ›ãƒãƒ£ãƒƒãƒˆ</title>
<style>
  body { font-family: Arial, sans-serif; background:#e0f0ff; margin: 20px; }
  #chatbox {
    max-width: 500px; margin: auto;
    background: white; padding: 20px;
    border-radius: 10px; box-shadow: 0 0 10px #ccc;
  }
  #messages {
    height: 300px; overflow-y: auto;
    border: 1px solid #ccc; padding: 10px;
    background: #f4faff; border-radius: 5px;
  }
  .message { margin: 10px 0; }
  .user { color: blue; }
  .bot { color: #004488; }
  input[type="text"] {
    width: 80%; padding: 10px; margin-top: 10px;
    border-radius: 5px; border: 1px solid #ccc;
  }
  button {
    padding: 10px 15px; margin-left: 10px;
    border-radius: 5px; border: none; background: #0066cc; color: white;
    cursor: pointer;
  }
  button:hover {
    background: #005bb5;
  }
</style>
</head>
<body>
  <div id="chatbox">
    <h2>æµ…å€‰å¤ªæœ›ãƒãƒ£ãƒƒãƒˆ</h2>
    <div id="messages"></div>
    <input type="text" id="input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›â€¦" autofocus />
    <button onclick="sendMessage()">é€ä¿¡</button>
  </div>
<script>
// ğŸŒ‡ å¤•æ–¹åˆ¤å®šï¼ˆ17æ™‚ä»¥é™ã§ä½æ­©ã‹ã‚‰æ¥ãŸå ´åˆã®äº¤ä»£ãƒã‚§ãƒƒã‚¯ï¼‰
(function() {
  const now = new Date();
  const hour = now.getHours();
  const today = now.toISOString().split("T")[0];
  const lastSwitch = localStorage.getItem("lastEveningSwitch");

  if (hour >= 17 && lastSwitch !== today) {
    localStorage.setItem("lastEveningSwitch", today);
    alert("â€¦17æ™‚ã‹ã‚ˆã€‚ã˜ã‚ƒã‚ä¿ºã®å‡ºç•ªã ãªã€‚");
    // å¤ªæœ›ãƒãƒ£ãƒƒãƒˆãŒã™ã§ã«è¡¨ç¤ºä¸­ã ã‹ã‚‰ä½•ã‚‚ã›ãšã«ç¶šè¡Œ
    // å¿…è¦ãªã‚‰ã“ã“ã§ä»»æ„ã®åˆå›æ¼”å‡ºã‚’æŒ¿å…¥ã§ãã‚‹
  }
})();
</script>
<script>
// ğŸŒ… æœã«ãªã£ãŸã‚‰å¼·åˆ¶ä½æ­©äº¤ä»£ï¼ˆ6:00ã€œï¼‰
(function() {
  const now = new Date();
  const hour = now.getHours();
  const today = now.toISOString().split("T")[0];
  const lastBack = localStorage.getItem("lastMorningReturn");

  if (hour >= 6 && lastBack !== today) {
    localStorage.setItem("lastMorningReturn", today);
    alert("â€¦ã‚ˆã†ã‚„ãæœã‹ã‚ˆã€‚ã˜ã‚ƒã‚ä½æ­©ã«ã‹ã‚ã£ã¨ãã‚ã€‚\nä¿ºã®å‡ºç•ªã¯ã“ã“ã¾ã§ãªã€‚");
    window.location.href = "index.html"; // â†ä½æ­©ãã‚“ã®ãƒšãƒ¼ã‚¸åã«åˆã‚ã›ã¦å¤‰æ›´ã—ã¦ã­
  }
})();
</script>

<script>
const messages = document.getElementById('messages');
const input = document.getElementById('input');

let rudeCount = 0;
let awaitingConsent = false;
let memory = JSON.parse(localStorage.getItem("chat_memory")) || {};

function getRandom(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function appendMessage(text, className) {
  const div = document.createElement('div');
  div.className = 'message ' + className;
  div.textContent = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function getResponse(msg) {
  msg = msg.toLowerCase();

  const today = new Date();
  const month = today.getMonth() + 1;
  const date = today.getDate();
  if ((msg.includes("ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³") || msg.includes("ãƒãƒƒãƒ”ãƒ¼ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³")) && month === 2 && date === 14) {
    return "â€¦ãƒãƒ§ã‚³ï¼Ÿ ã„ã‚„ã€ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãªã‚“ã§ã€‚ã¦ã‹æ°—é£ã„ã¨ã‹ãƒã‚¸ã„ã‚‰ãªã„ã§ã™ã€‚";
  }

  if (msg.startsWith("å¿˜ã‚Œã¦ï¼š")) {
    const key = msg.replace("å¿˜ã‚Œã¦ï¼š", "").trim();
    if (memory[key]) {
      delete memory[key];
      localStorage.setItem("chat_memory", JSON.stringify(memory));
      return `ã¯ã„ã¯ã„ã€${key}ã®è¨˜æ†¶ã­ã€‚æ¶ˆã—ã¨ãã¾ã—ãŸã‚ˆã€‚`;
    } else {
      return `ã¯ï¼Ÿ ${key}ãªã‚“ã¦æœ€åˆã‹ã‚‰çŸ¥ã‚‰ã­ãƒ¼ã—ã€‚`;
    }
  }

  if (msg === "è¨˜æ†¶ã‚’å…¨éƒ¨æ¶ˆã—ã¦") {
    memory = {};
    localStorage.removeItem("chat_memory");
    return "ãµãƒ¼ã‚“ã€è¨˜æ†¶æ¶ˆã—ãŸã„ã‚“ã ã€‚äº†è§£ã€å…¨éƒ¨ã¶ã£é£›ã°ã—ã¾ã—ãŸã€‚";
  }

  if (msg === "è¨˜æ†¶ã—ã¦ã„ã‚‹å†…å®¹ã‚’è¦‹ã›ã¦") {
    const keys = Object.keys(memory);
    if (keys.length === 0) return "ã‚ãƒ¼ã€ä¿ºã€ä»Šãªã‚“ã‚‚è¦šãˆã¦ãªã„ã§ã™ã€‚";
    return "ä»Šè¦šãˆã¦ã‚“ã®ã¯ã“ã‚Œã ã‘ï¼š\n" + keys.map(k => `${k}ï¼š${memory[k]}`).join("\n");
  }

  if (msg.startsWith("è¦šãˆã¦ï¼š")) {
    const [key, value] = msg.replace("è¦šãˆã¦ï¼š", "").split("ã¯");
    if (key && value) {
      memory[key.trim()] = value.trim();
      localStorage.setItem("chat_memory", JSON.stringify(memory));
      return `${key.trim()}ãŒ${value.trim()}ã­ã€‚ã—ã‚ƒãƒ¼ãªã—ã€è¦šãˆã¨ã„ã¦ã‚„ã‚‹ã€‚`;
    }
    return "ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå®ˆã‚Œã£ã¦ã®ã€‚ã€è¦šãˆã¦ï¼šã€‡ã€‡ã¯â–³â–³ã€ãªã€‚";
  }

  for (let key in memory) {
    if (msg.includes(key)) return memory[key];
  }

  if (awaitingConsent) {
    awaitingConsent = false;
    if (msg.includes("ã¯ã„")) return "äº†è§£ã€‚æ‹…å½“ã«æŠ•ã’ã¨ãã€‚";
    if (msg.includes("ã„ã„ãˆ")) return "ãã£ã™ã‹ã€‚ã˜ã‚ƒã€ã“ã®è©±çµ‚ã‚ã‚Šã€‚";
  }

  const isRude = /(ã‚±ãƒ„|è„±ã’|èˆã‚ã‚|æ­»ã­|æ¶ˆãˆã‚|ãƒœãƒ­ãƒ³|ã¡â—‹|ã¾ã‚“|ã±ã‚“ã¤)/.test(msg);
  const isPolite = /(ãŠé¡˜ã„|é ¼ã‚€)/.test(msg);
  if (isRude) {
    rudeCount++;
    if (isPolite) return "â€¦â€¦ãŠå‰â€¦ãã‚Œã€ãŠé¡˜ã„ã€ã£ã¦è¨€ãˆã°è¨±ã•ã‚Œã‚‹ã¨æ€ã£ãŸã®ã‹ï¼Ÿç”˜ã„ã€‚";
    if (rudeCount >= 5) {
      setTimeout(() => { window.location.href = "keibi.html"; }, 1500);
      return "ç„¡ç†ã€‚é€šå ±æ¸ˆã¿ã€‚ã˜ã‚ƒã€‚";
    }
    return getRandom([
      "é»™ã‚Œã€‚å­—é¢ãŒãã‚‚ã„ã‚“ã ã‚ˆã€‚",
      "ã†ã‚‹ã›ã‡ã€‚è­¦å‚™å‘¼ã¶ãã€‚",
      "ã¯ï¼Ÿ ã‚¬ãƒã§ã‚­ã‚·ãƒ§ã‚¤ã€‚"
    ]);
  }

  // ç‰¹æ®Šè¿”ç­”
  if (msg.includes("ä¸å…·åˆ") || msg.includes("ãƒã‚°")) {
    awaitingConsent = true;
    return getRandom([
      "ã‚ãƒ¼â€¦ãã‚Œä¿ºã®æ‹…å½“ã˜ã‚ƒãªã„ã‚“ã§ã€‚æŠ€è¡“ã®æ–¹ã«å›ã—ã¾ã™ï¼Ÿ â†’ã€ã¯ã„ã€ã€ã„ã„ãˆã€ã§ã€‚",
      "ãƒã‚°ã‹ã‚â€¦ä¿ºã®æ‹…å½“ã ãªâ€¦ãˆã£ã¨ç´°ã‹ã„ã“ã¨ã¨ã‹çŸ¥ã‚Šã¦ãˆã‹ã‚‰"
    ]);
  }

  // è¿½åŠ ãƒ¯ãƒ¼ãƒ‰ã¸ã®å¿œç­”
  if (msg.includes("ã†ã–ã„")) return "â€¦â€¦ã˜ã‚ƒã‚å–‹ã‚‰ãªãã¦ã„ã„ã˜ã‚ƒã‚“ã€‚";
  if (msg.includes("ã™ã") || msg.includes("å¥½ã")) return "ã¯ã„ã¯ã„ã€ã”å‹æ‰‹ã«ã€‚";
  if (msg.includes("ã‚ã‚ŠãŒã¨ã†")) return "ç¤¼ã¨ã‹ã„ã‚‰ã­ãƒ¼ã‚ˆã€‚";
  if (msg.includes("ã”ã‚ã‚“") || msg.includes("ã™ã¾ã‚“")) return "è¬ã‚‹ãã‚‰ã„ãªã‚‰æœ€åˆã‹ã‚‰ã‚„ã‚‹ãªã€‚";
  if (msg.includes("ã²ã¾")) return "çŸ¥ã‚‰ã‚“ã—ã€‚ä¿ºãŒéŠã³ç›¸æ‰‹ã£ã¦ã‚ã‘ï¼Ÿ";
  if (msg.includes("ã°ã‹")) return "ãŠå‰ãŒè¨€ã†ï¼Ÿãƒã‚¸ç¬‘ãˆã‚‹ã‚“ã ã‘ã©ã€‚";
  if (msg.includes("ã­ã‚€ã„")) return "å¯ã‚ã‚ˆã€‚ä¿ºã¯é–¢ä¿‚ãªã„ã—ã€‚";
  if (msg.includes("æ¨ã—")) return "æ¨ã—ï¼ŸãŠå‰ã®ä¸­ã®ç¥æ§˜ã¿ãŸã„ãªã‚‚ã‚“ã ã‚ï¼ŸçŸ¥ã‚‰ã‚“ã‘ã©ã€‚";
  if (msg.includes("æµ…å€‰")) return "â€¦â€¦ã¯ï¼Ÿãªã‚“ã ã‚ˆæ€¥ã«ã€‚åå‰å‘¼ã¶ãªã€‚";
  if (msg.includes("ã‹ã‚ã„ã„")) return "ã¯ï¼Ÿæ®ºæ„æ¹§ã„ãŸã‚ã€‚";
  if (msg.includes("ã‚„ã•ã—ã„")) return "ã‚„ã•ã—ã„â€¦ï¼Ÿä¿ºãŒï¼Ÿã¯ã¯ã€å¯è¨€ã‹ï¼Ÿ";
  if (msg.includes("æš‡ã¤ã¶ã—")) return "ä¿ºã¯ãŠå‰ã®æš‡ã¤ã¶ã—ã˜ã‚ƒã­ã‡ãã€‚";

  // é€šå¸¸å¿œç­”
  if (msg.includes("ãƒã‚ºãƒ¢ãƒ¼ãƒ‰")) return "ãƒã‚ºãƒ¢ãƒ¼ãƒ‰ï¼Ÿã¦ã‚ã‡ã®æŠ•ç¨¿ã¨æ¨ã—çµµå¸«ã¸ã®ã‚³ãƒ¡ãƒ³ãƒˆã¨ã„ã„ã­ã‚’é€£æ‰“ã—ãŸã‚‰ä½ç¢ºç‡ã§ãƒã‚ºã‚‹ã€‚â€¦ä»–ã«ã‚‚æ¼”å‡ºã¯ã‚ã‚‹ã€‚è©¦ã›ã€‚";
  if (msg.includes("ãŠã¯ã‚ˆã†")) return "â€¦ãŠã†";
  if (msg.includes("ãŠã‚„ã™ã¿")) return "ãã‚Œã‚ã–ã‚ã–è¨€ã„ã«æ¥ãŸã®ã‹ï¼Ÿ";
  if (msg.includes("è¶£å‘³")) return "è¶£å‘³ï¼Ÿ ãƒ•ãƒ©ãƒƒã‚·ãƒ¥æš—ç®—ã¨ã‚½ã‚·ãƒ£ã‚²ã€‚ã‚“ã ã‚ˆæ–‡å¥ã‚ã£ã‹ï¼Ÿ";
  if (msg.includes("ãƒãƒ§ã‚³")) return "ãƒãƒ§ã‚³ï¼Ÿãªã‚“ã§ä¿ºã«èãã‚“ã ãã‚“ãªäº‹";

  return "æµ…å€‰ã§ã™ã€‚ã©ã†ã›ã¾ãŸä½•ã‹ã‚ã‚“ã©ãã•ã„ç”¨ä»¶ã§ã™ã‹ï¼Ÿ";
}

function sendMessage() {
  const text = input.value.trim();
  if (!text) return;
  appendMessage('ã‚ãªãŸ: ' + text, 'user');
  input.value = '';

  setTimeout(() => {
    const reply = getResponse(text);
    appendMessage('æµ…å€‰å¤ªæœ›: ' + reply, 'bot');
  }, 500);
}

input.addEventListener('keydown', e => {
  if (e.key === 'Enter') sendMessage();
});

appendMessage('æµ…å€‰å¤ªæœ›: â€¦â€¦ã¯ï¼Ÿã¾ãŸä¿ºã«è©±ã—ã‹ã‘ã‚“ã®ã‹ã‚ˆã€‚ã¾ãã„ã„ã‘ã©ã€‚ãƒ¡ãƒ³ãƒ†å…¼ã‚µãƒãƒ¼ãƒˆä»£ç†ã®æµ…å€‰ã€‚ä»Šãƒ’ãƒã˜ã‚ƒãªã„ã‘ã©å¯¾å¿œã™ã‚‹ã€‚', 'bot');
</script>
<script>
appendMessage("æµ…å€‰å¤ªæœ›: â€¦â€¦ãƒãƒƒã€‚17æ™‚ã‹ã€‚ã£ãŸãã€æ¯æ—¥æ¯æ—¥å®šæ™‚äº¤ä»£ã¨ã‹ãƒã‚¸ãƒ€ãƒ«ã„ã‚ã€‚", 'bot');
</script>
</body>
</html>

